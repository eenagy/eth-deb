#!/usr/bin/make -f
export NIM_DIR=/opt/lib/nim/nim-2.0.2
export USE_SYSTEM_NIM=1
export BINARIES=nimbus_beacon_node nimbus_validator_client deposit_contract nimbus_signing_node nimbus_light_client logtrace
#export NIMFLAGS="-d:disableMarchNative --gcc.options.debug:'-g1' --clang.options.debug:'-gline-tables-only'"
export NIMFLAGS="-d:release"
export GIT_COMMIT="dc19b08"
export PARTIAL_STATIC_LINKING=1
export QUICK_AND_DIRTY_COMPILER=1
export LOG_LEVEL="TRACE"
export CFLAGS += -O
export CFLAGS += -D__BLST_PORTABLE__
export CFLAGS += -fPIC -D_FORTIFY_SOURCE=2

%:
	dh $@


$(BINARIES): 
	make $@

override_dh_auto_build: $(BINARIES)
	chmod +x scripts/run-beacon-node.sh

override_dh_auto_clean:
	# on ubuntu clean fails, before dependency installation
	# on bookworm clean succeeds, even if dependency is not installed
	-make -j1 clean

override_dh_auto_test:
	# -make update
	#make -j1 all_tests
