#!/bin/bash
set -e

. /usr/share/debconf/confmodule

declare -A CONFIG

adduser --system --quiet --group eth-node-mainnet-erigon 
mkdir -p /var/lib/eth-node-mainnet/erigon
chown eth-node-mainnet-erigon:eth-node-mainnet-erigon /var/lib/eth-node-mainnet/erigon 

jwt_file=/etc/eth-node-mainnet/jwt.hex
if [ ! -f "$jwt_file" ]; then
	openssl rand -hex 32 | tr -d "\n" | tee "$jwt_file" >/dev/null
fi

if [ "$1" = triggered -a "$service_was_running" '!=' 0 ];
then
	deb-systemd-invoke restart eth-node-mainnet-service-erigon
fi

if [ "$1" '!=' triggered ];
then
	dpkg-trigger eth-node-mainnet-service-erigon-config-changed

fi
#DEBHELPER#

exit 0
