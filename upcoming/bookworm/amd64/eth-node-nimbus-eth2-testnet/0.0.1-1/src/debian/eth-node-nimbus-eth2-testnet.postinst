#!/bin/bash
set -e

. /usr/share/debconf/confmodule

declare -A CONFIG

adduser --system --quiet --group eth-node-nimbus-eth2-testnet
mkdir -p /var/lib/eth-node-testnet/nimbus-eth2
chown eth-node-nimbus-eth2-testnet:eth-node-nimbus-eth2-testnet /var/lib/eth-node-testnet/nimbus-eth2

jwt_file=/etc/eth-node-testnet/jwt.hex
if [ ! -f "$jwt_file" ]; then
	openssl rand -hex 32 | tr -d "\n" | tee "$jwt_file" >/dev/null
fi

if [ "$1" = triggered -a "$service_was_running" '!=' 0 ];
then
	deb-systemd-invoke restart eth-node-testnet-service-nimbus-eth2
fi

if [ "$1" '!=' triggered ];
then
	dpkg-trigger eth-node-testnet-service-nimbus-eth2-config-changed

fi
#DEBHELPER#

exit 0
