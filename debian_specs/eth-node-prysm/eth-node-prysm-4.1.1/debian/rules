#!/usr/bin/make -f

export BUILD_DIR=/tmp
export GOCACHE=$(BUILD_DIR)/.gocache
export GOROOT=$(BUILD_DIR)/go
export GOPATH=$(BUILD_DIR)/go-libs
export PATH :=$(PATH):$(GOROOT)/bin:$(GOPATH)/bin
export GO_VERSION=1.21.3
export GO_TAR=go$(GO_VERSION).linux-amd64.tar.gz


%:
	dh $@

override_dh_auto_test:
	# do not run the tests
	# TODO tests are failing under sbuild

override_dh_auto_clean:
	# Do nothing, patch the makefile
	#
	-rm $(GO_TAR)
	-rm $(BUILD_DIR)/go

override_dh_auto_build:
	wget -q --no-check-certificate https://go.dev/dl/$(GO_TAR)
	tar -C $(BUILD_DIR) -xzf $(GO_TAR)
	rm $(GO_TAR)
	go env
	go install github.com/bazelbuild/bazelisk@v1.18.0
	ls -l $(GOPATH)/bin
	$(GOPATH)/bin/bazelisk build //cmd/beacon-chain:beacon-chain --config=release
	$(GOPATH)/bin/bazelisk build //cmd/validator:validator --config=release 


override_dh_installsystemd:
	dh_installsystemd --name=eth-node-prysm-service-mainnet
	dh_installsystemd --name=eth-node-prysm-service-sepolia

override_dh_dwz:
